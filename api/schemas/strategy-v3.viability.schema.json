{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "strategy_v3_viability",
  "description": "Evidence-based viability assessment for a campaign strategy (Roger Martin aligned).",
  "type": "object",
  "additionalProperties": false,
  "required": ["run_id", "version", "generated_at", "viability"],
  "properties": {
    "run_id": {
      "type": "string",
      "description": "Pipeline run identifier. Must match runs/<...>/ prefix."
    },
    "version": {
      "type": "string",
      "description": "Version string for the viability model, e.g. strategy_v3@2025-11-27-v1."
    },
    "generated_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when this viability assessment was generated."
    },

    "viability": {
      "type": "object",
      "description": "Top-level viability assessment for this strategy.",
      "additionalProperties": false,
      "required": ["grade", "diagnostics"],
      "properties": {
        "grade": {
          "type": "string",
          "enum": ["weak", "moderate", "strong"],
          "description": "Overall viability judgement for the strategy, based on diagnostics and warnings."
        },
        "rationale": {
          "type": "string",
          "description": "Short human-readable explanation of WHY the grade was assigned (for UI display)."
        },

        "diagnostics": {
          "type": "object",
          "description": "Structured multi-dimensional assessment driving the grade.",
          "additionalProperties": false,
          "required": [
            "problem_strength",
            "urgency_strength",
            "field_of_play",
            "winning_logic_strength",
            "differentiation_strength",
            "evidence_sufficiency",
            "cohort_viability",
            "coherence",
            "doability",
            "right_to_play"
          ],
          "properties": {
            "problem_strength": {
              "type": "string",
              "enum": ["low", "medium", "high"],
              "description": "How strong and well-evidenced the buyer problem is."
            },
            "urgency_strength": {
              "type": "string",
              "enum": ["low", "medium", "high"],
              "description": "How strong and well-evidenced the 'why now' case is."
            },
            "field_of_play": {
              "type": "string",
              "enum": ["clear", "unclear", "fragmented"],
              "description": "How clear and focused the chosen playing field is (where to play)."
            },
            "winning_logic_strength": {
              "type": "string",
              "enum": ["low", "medium", "high"],
              "description": "Strength of the logic that explains how we win on that field."
            },
            "differentiation_strength": {
              "type": "string",
              "enum": ["low", "medium", "high"],
              "description": "Strength of meaningful differentiation versus alternatives."
            },
            "evidence_sufficiency": {
              "type": "string",
              "enum": ["low", "medium", "high"],
              "description": "Depth and breadth of evidence backing the strategy."
            },
            "cohort_viability": {
              "type": "string",
              "enum": ["low", "medium", "high"],
              "description": "Is the addressable cohort large and coherent enough to be worth the campaign?"
            },
            "coherence": {
              "type": "string",
              "enum": ["low", "medium", "high"],
              "description": "How well the choices reinforce each other (why to play + how to win + actions)."
            },
            "doability": {
              "type": "string",
              "enum": ["low", "medium", "high"],
              "description": "Practical feasibility given implied motions and resources."
            },
            "right_to_play": {
              "type": "string",
              "enum": ["low", "medium", "high"],
              "description": "How strong the supplierâ€™s capabilities and proof are to play and win here."
            }
          }
        },

        "warnings": {
          "type": "array",
          "description": "Specific issues or risks identified by the model (used for UI alerts and coaching).",
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["type", "severity", "message"],
            "properties": {
              "type": {
                "type": "string",
                "description": "Machine-readable warning type (e.g. missing_problem, missing_urgency, cohort_too_small)."
              },
              "severity": {
                "type": "string",
                "enum": ["low", "medium", "high"],
                "description": "Impact of this issue on overall viability."
              },
              "dimension": {
                "type": "string",
                "enum": [
                  "problem_strength",
                  "urgency_strength",
                  "field_of_play",
                  "winning_logic_strength",
                  "differentiation_strength",
                  "evidence_sufficiency",
                  "cohort_viability",
                  "coherence",
                  "doability",
                  "right_to_play",
                  "overall"
                ],
                "description": "Which diagnostic dimension this warning is most closely associated with."
              },
              "message": {
                "type": "string",
                "description": "Short, user-facing message explaining the issue in plain language."
              },
              "evidence": {
                "type": "object",
                "description": "Optional evidence excerpt that supports the warning.",
                "additionalProperties": true
              }
            }
          },
          "default": []
        }
      }
    },

    "inputs_snapshot": {
      "type": "object",
      "description": "Optional light snapshot of key numbers used by the viability engine (for debugging/learning).",
      "additionalProperties": false,
      "required": [
        "claims_considered",
        "csv_rows",
        "estimated_segment_count"
      ],
      "properties": {
        "claims_considered": {
          "type": "integer",
          "minimum": 0,
          "description": "Number of evidence claims considered in viability scoring."
        },
        "csv_rows": {
          "type": "integer",
          "minimum": 0,
          "description": "Row count from csv_normalized.meta.rows."
        },
        "estimated_segment_count": {
          "type": "integer",
          "minimum": 0,
          "description": "Rough number of identifiable segments or tiers (0 if not computed)."
        }
      }
    },

    "learning_hooks": {
      "type": "object",
      "description": "Optional area reserved for future outcome feedback / model learning.",
      "additionalProperties": true,
      "properties": {
        "labels": {
          "type": "object",
          "description": "Ground-truth labels captured later (e.g. campaign_success, pipeline_lift).",
          "additionalProperties": true
        },
        "notes": {
          "type": "string",
          "description": "Optional human commentary on campaign success, used for future tuning."
        }
      }
    }
  }
}

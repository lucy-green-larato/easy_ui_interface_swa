<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Larato | SWA Sales Tools</title>
  <meta name="description" content="Inside Track–powered tools for front-end B2B engagement."/>
  <style>
    :root { --bg:#f8fafc; --card:#fff; --text:#0f172a; --muted:#64748b; --brand:#1e40af; }
    * { box-sizing: border-box }
    body { font-family: system-ui,"Segoe UI",Roboto,Arial,sans-serif; background:var(--bg); color:var(--text); margin:0 }
    header, main, footer { max-width: 960px; margin: 0 auto; padding: 24px }
    .nav { display:flex; justify-content:space-between; align-items:center; gap:12px }
    .btn { padding:10px 14px; border-radius:10px; border:1px solid #cbd5e1; background:#fff; cursor:pointer }
    .btn:hover { background:#f1f5f9 }
    .btn-primary { background:var(--brand); border-color:var(--brand); color:#fff }
    .btn-primary:hover { filter:brightness(1.05) }
    .card { background:var(--card); border:1px solid #e2e8f0; border-radius:16px; padding:20px }
    .grid { display:grid; gap:12px }
    .grid-2 { grid-template-columns: repeat(auto-fit,minmax(220px,1fr)) }
    .muted { color:var(--muted); font-size: 14px }
    a.tool { display:block; padding:14px; border:1px solid #e2e8f0; border-radius:12px; background:#fff; text-decoration:none; color:inherit }
    a.tool:hover { background:#f8fafc }
    .hide { display:none }
  </style>
</head>
<body>
  <header class="nav">
    <h1 style="margin:0">SWA Sales Tools <span class="muted">| Larato Best Practice</span></h1>
    <div id="authButtons">
      <button class="btn" onclick="login()">Sign in</button>
    </div>
  </header>

  <main class="grid" aria-labelledby="welcome-heading">
    <!-- Public welcome -->
    <section id="welcome" class="card">
      <h2 id="welcome-heading">Welcome</h2>
      <p class="muted">These tools help you qualify opportunities, make the best first contact, and follow up using Inside Track insights. Please sign in to access the facilities.</p>
      <div><button class="btn-primary btn" onclick="login()">Sign in with Microsoft</button></div>
      <p class="muted" style="margin-top:12px">By signing in you agree to Larato’s internal use policy and privacy notice.</p>
    </section>

    <!-- Signed-in dashboard -->
    <section id="dashboard" class="card hide" aria-live="polite">
      <h2>Good to see you<span id="userName"></span></h2>
      <p class="muted">Choose a facility to start. You can paste Inside Track details on each page.</p>

      <div class="grid grid-2" style="margin-top:12px">
        <a class="tool" href="lead-qualification.html">Lead Qualification</a>
        <a class="tool" href="intro-builder.html">First Introduction Builder</a>
        <a class="tool" href="email-gen.html">Introductory Email Generator</a>
        <a class="tool" href="follow-up.html">Follow-up Planner</a>
        <a class="tool" href="competition.html">Competitive Positioning</a>
        <a class="tool" href="checklist.html">First-Step Engagement Checklist</a>
      </div>

      <div style="margin-top:16px">
        <button class="btn" onclick="logout()">Sign out</button>
      </div>
    </section>
  </main>

  <footer class="card" style="margin:24px auto">
    <div class="muted">© Larato • Internal use only • <a href="privacy.html">Privacy</a></div>
  </footer>

  <script>
    async function login(){ location.href='/.auth/login/aad?post_login_redirect_uri=/'; }
    async function logout(){ location.href='/.auth/logout'; }
    (async function init(){
      try {
        const res = await fetch('/.auth/me', { credentials: 'include' });
        if (!res.ok) throw new Error('auth check failed');
        const data = await res.json();
        const princ = (data && data.clientPrincipal) || null;
        const welcome = document.getElementById('welcome');
        const dash = document.getElementById('dashboard');
        const name = document.getElementById('userName');
        const authButtons = document.getElementById('authButtons');
        if (princ) {
          welcome.classList.add('hide');
          dash.classList.remove('hide');
          name.textContent = princ.userDetails ? `, ${princ.userDetails}` : '';
          authButtons.innerHTML = '<button class="btn" onclick="logout()">Sign out</button>';
        } else {
          welcome.classList.remove('hide');
          dash.classList.add('hide');
          authButtons.innerHTML = '<button class="btn" onclick="login()">Sign in</button>';
        }
      } catch {}
    })();
  </script>
</body>
</html>

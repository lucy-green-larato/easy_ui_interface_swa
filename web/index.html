<!-- web/index.html 08-10-2025 v9 (Main menu: avatar next to H1, PBI expand, tokenised, fixes) -->
<!doctype html>
<html lang="en" data-theme="light">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="qual-api-key" content="__INJECT_AT_RENDER__" />
  <title>Inside Track Business Growth Tools</title>
  <meta name="color-scheme" content="light dark" />
  <base href="/" />
  <!-- First-paint guard: decide visibility before styles/js load -->
  <style>
    /* Hide both only during the pre-auth phase to avoid flashes */
    body.preauth #welcome,
    body.preauth #dashboard {
      display: none;
    }

    /* Default after boot: keep both hidden until an auth flag is set */
    #welcome,
    #dashboard {
      display: none;
    }

    /* Authenticated → show dashboard */
    html[data-likely-authed="1"] #dashboard {
      display: block;
    }

    /* Not authenticated → show welcome */
    html[data-likely-authed="0"] #welcome {
      display: block;
    }
  </style>
  <!-- Decide initial state synchronously, before CSS/JS execute -->
  <script>
    (function () {
      try {
        var c = document.cookie || "";
        var authed =
          c.indexOf("AppServiceAuthSession=") !== -1 ||
          c.indexOf("StaticWebAppsAuthCookie=") !== -1;
        // Set explicit 1 or 0 so boot CSS can render the right section
        document.documentElement.setAttribute("data-likely-authed", authed ? "1" : "0");
      } catch (e) {
        // If anything goes wrong, show welcome (safe default)
        document.documentElement.setAttribute("data-likely-authed", "0");
      }
    })();
  </script>

  <!-- Global tokenised stylesheet -->
  <link rel="stylesheet" href="styles.css" />

  <!-- Power BI SDK (only needed on this page) - must load before main.js -->
  <script src="vendor/powerbi.min.js" defer></script>

  <!-- Page-specific styles (keep minimal; rely on styles.css for base/components) -->
  <style>
    :root {
      --stage-max: 1180px;
    }

    /* Layout width for index containers */
    .container {
      max-width: var(--stage-max, 1180px);
      margin: 0 auto;
      padding: 12px 20px 28px;
    }

    /* Page intro + avatar */
    .page-intro {
      margin: 18px 0 10px;
    }

    .welcome-bar {
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
      margin-bottom: 6px;
    }

    .avatar {
      --size: clamp(52px, 6vw, 74px);
      width: var(--size);
      height: var(--size);
      border-radius: 999px;
      overflow: hidden;
      flex: 0 0 auto;
      background: #DDD;
      border: 3px solid rgba(70, 30, 92, .4);
      box-shadow: 0 1px 2px rgba(0, 0, 0, .08);
    }

    .avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    @supports (color: color-mix(in srgb, white 50%, black)) {
      .avatar {
        border-color: color-mix(in srgb, var(--accent) 40%, var(--brand-gold) 20%);
      }
    }

    .avatar.is-empty::after {
      content: "✦";
      display: grid;
      place-items: center;
      width: 100%;
      height: 100%;
      font-size: calc(var(--size)*.46);
      color: var(--brand-gold);
    }

    /* Section framing */
    .backdrop {
      border-radius: 14px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      box-shadow: var(--shadow);
      padding: 16px;
    }

    .section-head {
      border-bottom: 2px solid rgba(70, 30, 92, .12);
    }

    @supports (color: color-mix(in srgb, white 50%, black)) {
      .section-head {
        border-bottom: 2px solid color-mix(in srgb, var(--accent) 12%, transparent);
      }
    }

    /* Index grids (3 → 2 → 1) */
    .grid-3 {
      display: grid;
      gap: 14px;
      grid-template-columns: repeat(3, minmax(0, 1fr));
    }

    @media (max-width:980px) {
      .grid-3 {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width:640px) {
      .grid-3 {
        grid-template-columns: 1fr;
      }
    }

    /* Brand tiles — single source of truth */
    /* Sales cards: background #461E5C, hover #64234A, white text (same in light & dark) */
    .group-sales .tool {
      background: var(--c-accent);
      border-color: var(--d-accent-pressed);
      color: #fff;
    }

    .group-sales .tool .tool-title {
      color: #fff;
    }

    .group-sales .tool small {
      color: color-mix(in srgb, #fff 82%, transparent);
    }

    html[data-theme="dark"] .group-sales .tool {
      background: var(--d-accent);
      border-color: var(--d-accent-pressed);
      color: #fff;
    }

    html[data-theme="dark"] .group-sales .tool .tool-title {
      color: #fff;
    }

    html[data-theme="dark"] .group-sales .tool small {
      color: color-mix(in srgb, #fff 82%, transparent);
    }

    /* Marketing cards: background #FFAD03, hover #E79101, black text (same in light & dark) */
    .group-marketing .tool {
      background: var(--c-gold);
      border-color: var(--c-gold-pressed);
      color: #000;
    }

    .group-marketing .tool .tool-title {
      color: #000;
    }

    .group-marketing .tool small {
      color: color-mix(in srgb, #000 65%, transparent);
    }

    /* Dark theme uses the same colours via dark tokens (keeps parity) */
    html[data-theme="dark"] .group-marketing .tool {
      background: var(--d-gold);
      border-color: var(--d-gold-pressed);
      color: #000;
    }

    html[data-theme="dark"] .group-marketing .tool .tool-title {
      color: #000;
    }

    html[data-theme="dark"] .group-marketing .tool small {
      color: color-mix(in srgb, #000 65%, transparent);
    }

    /* Hovers */
    @media (hover:hover) {
      .group-sales .tool:hover {
        background: var(--d-accent-pressed);
        transform: translateY(-1px);
      }

      .group-sales .tool:hover .tool-title,
      .group-sales .tool:hover small {
        color: #fff;
      }

      .group-marketing .tool:hover {
        background: var(--c-gold-pressed);
        transform: translateY(-1px);
      }

      html[data-theme="dark"] .group-marketing .tool:hover {
        background: var(--d-gold-pressed);
      }
    }

    /* Tile minimum height tweak */
    :root {
      --tile-min-h: 140px;
    }

    /* PBI card + fullscreen via [data-fullscreen] */
    .pbi-card {
      margin-top: 18px;
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: var(--shadow);
      padding: 16px;
    }

    .pbi-head {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 10px;
    }

    .pbi-head .pbi-actions {
      margin-inline-start: auto;
    }

    #reportContainer {
      width: 100%;
      min-height: 520px;
      border: 1px solid var(--border);
      border-radius: 12px;
      background: var(--card-bg);
      box-shadow: var(--shadow);
    }

    .pbi-card[data-fullscreen] {
      position: fixed;
      inset: 0;
      z-index: var(--z-overlay, 1000);
      padding: 16px;
      border-radius: 0;
      background: var(--bg);
      max-width: none;
      margin: 0;
      /* override .container caps if applied */
    }

    .pbi-card[data-fullscreen] #reportContainer {
      min-height: calc(100dvh - 84px);
    }

    /* Prevent background scroll when we toggle .no-scroll on <html> */
    .no-scroll {
      overflow: hidden;
    }

    /* ---------- STATE TOGGLES ---------- */
    .hide {
      display: none;
    }

    body.preauth #dashboard {
      display: none;
    }

    /* signed OUT */
    body.authed #welcome {
      display: none;
    }

    /* signed IN  */
    .home .group-sales .tool {
      background: var(--accent);
      border: 1px solid var(--accent-pressed);
      color: #fff;
    }

    .home .group-sales .tool .tool-title {
      color: #fff;
    }

    .home .group-sales .tool small {
      color: color-mix(in srgb, #fff 82%, transparent);
    }

    .home .group-marketing .tool {
      background: var(--brand-gold);
      border: 1px solid color-mix(in srgb, var(--brand-gold) 65%, black);
      color: #111;
    }

    .home .group-marketing .tool .tool-title {
      color: #111;
    }

    .home .group-marketing .tool small {
      color: color-mix(in srgb, #111 65%, transparent);
    }

    /* Hover: keep sales on the purple scale so white text stays readable;
       gently darken gold so dark text stays readable */
    @media (hover: hover) and (pointer: fine) {
      .home .group-sales .tool:hover {
        background: #8A7D96;
        transform: translateY(-1px);
      }

      .home .group-sales .tool:hover .tool-title,
      .home .group-sales .tool:hover small {
        color: #fff;
      }

      .home .group-marketing .tool:hover {
        background: #FFCD92;
        transform: translateY(-1px);
      }
    }

    #pbiSection {
      display: block;
    }

    #pbiSection.hide {
      display: block;
    }

    @media (hover:hover) {

      .group-sales .tool:hover,
      .group-marketing .tool:hover {
        filter: none;
      }
    }
  </style>
</head>

<body class="preauth home">
  <!-- Global header (uses .app-header from styles.css) -->
  <header class="app-header" role="banner">
    <div class="header-left">
      <img class="logo" id="brandLogo" src="./assets/larato-logo-bullet.svg" alt="Larato" />
      <div class="brand-text">
        <div class="app-title">Inside Track Sales Accelerator</div>
        <div class="kicker">Find the right accounts. Win the right deals.</div>
      </div>
    </div>
    <div class="header-right" id="authButtons">
      <button id="themeToggle" class="btn btn-tertiary" type="button" aria-pressed="false"
        aria-label="Switch theme">Theme</button>
    </div>
  </header>

  <main>
    <section class="container">
      <!-- Signed OUT (default) -->
      <section id="welcome" class="page-intro" aria-labelledby="welcome-h">
        <div class="welcome-bar">
          <div class="avatar is-empty" aria-hidden="true"></div>
          <h1 id="welcome-h" class="section-title">Welcome</h1>
        </div>
        <p class="welcome-text">From insight to next meeting. Sign in to qualify accounts, build campaigns, and equip
          sales in minutes.</p>
        <a id="btnSignInPrimary" class="btn btn-accent" href="/.auth/login/aad?post_login_redirect_uri=/">Sign in
          with Microsoft</a>
      </section>

      <!-- Signed IN -->
      <section id="dashboard" aria-live="polite">
        <div class="page-intro" style="margin-bottom:10px">
          <div class="welcome-bar">
            <div id="userAvatar" class="avatar is-empty" aria-label="User profile image" role="img"></div>
            <h1 class="section-title">Welcome back, <span id="userName"></span></h1>
          </div>
        </div>

        <!-- Tools -->
        <section class="backdrop" aria-label="Tool launcher">
          <div class="section-head">
            <h2 class="section-title">Sales buddies</h2>
          </div>

          <div class="grid-3 group-sales" role="list">
            <a class="tool" role="listitem" href="./engagement/index.html" title="Open Call scripts and emails">
              <div class="tool-title">Sales engagement</div>
              <small>Engage faster. Convert intent.</small>
            </a>
            <a class="tool" role="listitem" href="./qualification/index.html" title="Open Lead qualification">
              <div class="tool-title">Lead qualification</div>
              <small>Proof-led qualification in minutes.</small>
            </a>
            <a class="tool disabled" role="listitem" href="#" aria-disabled="true" tabindex="-1" title="Coming soon">
              <div class="tool-title">Beat your competitors</div>
              <small>Battlecards that win.</small>
            </a>
          </div>

          <div class="section-head" style="margin-top:14px">
            <h2 class="section-title">Marketing buddies</h2>
          </div>

          <div class="grid-3 group-marketing" role="list">
            <a class="tool" role="listitem" href="./campaign/index.html" title="Open Campaign Builder">
              <div class="tool-title">Campaign Builder</div>
              <small>Create evidence-first B2B campaigns, fast.</small>
            </a>
            <a class="tool" role="listitem" href="./ch-strategic/index.html" title="Open Strategic Report matcher">
              <div class="tool-title">Insight Miner</div>
              <small>Mine Companies House filings for evidence about the inisghts you need.</small>
            </a>
            <a class="tool disabled" role="listitem" href="#" aria-disabled="true" tabindex="-1" title="Coming soon">
              <div class="tool-title">Differentiation &amp; market-beating messaging</div>
              <small>Stand out with substance, not noise.</small>
            </a>
          </div>
        </section>

        <!-- Power BI (index only) -->
        <section class="pbi-card" id="pbiSection">
          <div class="pbi-head">
            <h2 class="section-title">Sales &amp; Marketing Intelligence</h2>
            <div class="pbi-actions">
              <button class="btn btn-tertiary" id="btnExpandPBI" aria-controls="reportContainer" aria-pressed="false"
                aria-label="Enter full screen">Expand</button>
            </div>
          </div>
          <div id="reportContainer" role="region" aria-label="Power BI Report"></div>
          <p id="pbi-status" class="fineprint" style="margin-top:10px"></p>
          <p class="fineprint" style="margin-top:10px; font-size: 10px">© Larato Limited. Company Registration Number
            5451360. Registered
            in the UK.</p>
        </section>
      </section> <!-- /#dashboard -->

    </section> <!-- /.container -->
  </main>

  <!-- Page module -->
  <script type="module" src="src/js/main.js"></script>

  <!-- Tiny inline script to handle PBI fullscreen toggle -->
  <script>
    (function () {
      const card = document.getElementById('pbiSection');
      const btn = document.getElementById('btnExpandPBI');
      const root = document.documentElement; // <html>

      function toggleFS() {
        const expanded = card.toggleAttribute('data-fullscreen');
        btn.setAttribute('aria-pressed', expanded ? 'true' : 'false');
        btn.setAttribute('aria-label', expanded ? 'Exit full screen' : 'Enter full screen');
        btn.textContent = expanded ? 'Exit full screen' : 'Expand';
        root.classList.toggle('no-scroll', expanded);
      }
      btn?.addEventListener('click', toggleFS);
    })();
  </script>
</body>

</html>
<!-- web/engagement/index.html 11-10-2025 v1 (restored 3-col layout, header, help, diagnostics) -->
<!doctype html>
<html lang="en" data-app="inside-track-tools" data-theme="light" data-page="engagement">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Inside Track Sales Accelerator · Sales engagement</title>
  <meta name="color-scheme" content="light dark" />
  <script>
    (function () {
      try {
        // Try persistent keys first (keeps parity with main menu toggle)
        var theme = (localStorage.getItem('it-theme') || localStorage.getItem('theme') || '').toLowerCase();

        // Fallback to a cookie if present
        if (!theme) {
          var m = (document.cookie || '').match(/(?:^|;\s*)(?:it-theme|theme)=(dark|light)/i);
          theme = m ? m[1].toLowerCase() : '';
        }

        // Final fallback: OS preference
        if (!theme && window.matchMedia) {
          theme = matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        // Guard + apply before CSS loads
        if (theme !== 'dark' && theme !== 'light') theme = 'light';
        document.documentElement.setAttribute('data-theme', theme);
      } catch (e) { /* no-op */ }
    })();

    // Keep in sync if another tab toggles the theme
    window.addEventListener('storage', function (e) {
      if (e.key === 'it-theme' || e.key === 'theme') {
        var v = (e.newValue || '').toLowerCase();
        if (v === 'dark' || v === 'light') {
          document.documentElement.setAttribute('data-theme', v);
        }
      }
    });
  </script>
  <link rel="stylesheet" href="/styles.css?v=2025-10-09-fc2">
</head>

<body>
  <!-- HEADER (reused shell) -->
  <header class="app-header topbar compact" role="banner">
    <div class="header-left">
      <a class="brand-link" href="/" aria-label="Back to Inside Track main menu" title="Back to main menu">
        <img class="logo" src="/assets/larato-logo-bullet.svg" alt="" aria-hidden="true" />
        <div class="brand-text">
          <h1 class="app-title">Inside Track Sales Accelerator</h1>
          <p class="kicker">Sales engagement</p>
        </div>
      </a>
    </div>

    <div class="header-right">
      <!-- Sales model selector (wired to sales engagement form) -->
      <div class="calltype-mini" role="group" aria-labelledby="sales-model-label">
        <span id="sales-model-label" class="mini-label">Direct or partner sales</span>

        <select id="call_type" name="call_type" form="script-form" aria-describedby="call_type_error">
          <option value="">Select…</option>
          <option value="Direct" selected>Direct</option>
          <option value="Partner">Partner</option>
        </select>

        <label class="remember" for="remember_call_type">
          <input type="checkbox" id="remember_call_type" form="script-form" />
          <span>Remember</span>
        </label>

        <span id="call_type_error" class="error-inline" role="alert" aria-live="polite"></span>
      </div>

      <span class="model-note">
        <span class="label">Sales model in use:</span>
        <strong id="map-label">Direct</strong>
      </span>

      <button id="help" class="btn inline chip" type="button" title="About this tool">Help</button>

      <span id="user-badge" class="chip is-hidden" aria-live="polite" aria-atomic="true">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <circle cx="12" cy="7" r="4"></circle>
          <path d="M4 22c0-4 4-7 8-7s8 3 8 7"></path>
        </svg>
        <span id="user-email">Loading…</span>
      </span>
    </div>
  </header>

  <!-- LAYOUT -->
  <main id="main" class="layout" role="main">
    <!-- LEFT -->
    <section class="panel left" aria-label="Form">
      <form id="script-form" novalidate>
        <fieldset class="card" aria-labelledby="legend-call-details">
          <legend id="legend-call-details">Call details</legend>
          <div class="grid-2">
            <div class="field">
              <label for="seller_name">Your name <span aria-hidden="true" class="req">*</span></label>
              <input id="seller_name" name="seller_name" required autocomplete="name" />
              <p class="error" id="seller_name_error" role="alert" aria-live="polite"></p>
            </div>

            <!-- Mobile-only fallback for Sales model -->
            <div class="field field-calltype-xs">
              <label for="call_type_xs">Sales model <span aria-hidden="true" class="req">*</span></label>
              <select id="call_type_xs" name="call_type_xs" aria-describedby="call_type_error_xs">
                <option value="">Select…</option>
                <option value="Direct" selected>Direct</option>
                <option value="Partner">Partner</option>
              </select>
              <p class="error" id="call_type_error_xs" role="alert" aria-live="polite"></p>
            </div>

            <div class="field">
              <label for="seller_company">Your company <span aria-hidden="true" class="req">*</span></label>
              <input id="seller_company" name="seller_company" required autocomplete="organization" />
              <p class="error" id="seller_company_error" role="alert" aria-live="polite"></p>
            </div>

            <div class="field">
              <label for="prospect_name">Prospect name <span aria-hidden="true" class="req">*</span></label>
              <input id="prospect_name" name="prospect_name" required />
              <p class="error" id="prospect_name_error" role="alert" aria-live="polite"></p>
            </div>

            <div class="field">
              <label for="prospect_role">Prospect role <span aria-hidden="true" class="req">*</span></label>
              <input id="prospect_role" name="prospect_role" required placeholder="e.g., Finance Director" />
              <p class="error" id="prospect_role_error" role="alert" aria-live="polite"></p>
            </div>

            <div class="field">
              <label for="prospect_company">Prospect company <span aria-hidden="true" class="req">*</span></label>
              <input id="prospect_company" name="prospect_company" required />
              <p class="error" id="prospect_company_error" role="alert" aria-live="polite"></p>
            </div>
          </div>
        </fieldset>

        <fieldset class="card" aria-labelledby="legend-targeting">
          <legend id="legend-targeting">Targeting</legend>
          <div class="grid-2">
            <div class="field">
              <label for="product">Product <span aria-hidden="true" class="req">*</span></label>
              <select id="product" name="product" required>
                <option value="">Loading…</option>
              </select>
              <p class="error" id="product_error" role="alert" aria-live="polite"></p>
            </div>

            <div class="field">
              <label for="buyer_behaviour">Buyer behaviour <span aria-hidden="true" class="req">*</span></label>
              <select id="buyer_behaviour" name="buyer_behaviour" required>
                <option value="">Select…</option>
                <option>Innovator</option>
                <option>Early adopter</option>
                <option>Early majority</option>
                <option>Late majority</option>
                <option>Sceptic</option>
              </select>
              <p class="error" id="buyer_behaviour_error" role="alert" aria-live="polite"></p>
            </div>
          </div>
        </fieldset>

        <fieldset class="card" aria-labelledby="legend-preferences">
          <legend id="legend-preferences">Script preferences</legend>
          <div class="grid-2">
            <div class="field">
              <label for="tone">Tone</label>
              <select id="tone" name="tone">
                <option selected>Professional (corporate)</option>
                <option>Warm (professional)</option>
                <option>Straightforward</option>
              </select>
            </div>

            <div class="field">
              <label for="script_length">Length</label>
              <select id="script_length" name="script_length">
                <option>~150 words</option>
                <option selected>~300 words</option>
                <option>~450 words</option>
                <option>~650 words</option>
              </select>
            </div>
          </div>

          <div class="field">
            <label for="value_proposition">Unique Selling Points (optional)</label>
            <textarea id="value_proposition" name="value_proposition" rows="2"
              placeholder="e.g., pooled data; contract portability; self-serve provisioning"></textarea>
          </div>

          <div class="field">
            <label for="context">Other points to cover (optional)</label>
            <textarea id="context" name="context" rows="3"
              placeholder="Any specific themes you want woven into the call (comma, semicolon or new line separated)."></textarea>
          </div>

          <div class="field">
            <label for="next_step">Your desired next step</label>
            <input id="next_step" name="next_step"
              placeholder="e.g., I’ll send a 1-page summary and we can pick it up from there." />
          </div>
        </fieldset>

        <div class="actions">
          <button id="submit" class="btn primary" type="submit" disabled>
            <span class="btn-label">Go</span>
            <span class="spinner" aria-hidden="true"></span>
          </button>
          <button id="resetBtn" type="reset" class="btn small">Reset</button>
        </div>

        <div id="status" class="status" role="status" aria-live="polite"></div>

        <details id="diagnostics" class="diag card" style="margin-top:var(--s-5)">
          <summary>Diagnostics</summary>
          <pre id="diag-json" tabindex="0" aria-label="Diagnostics JSON"></pre>
          <p class="muted">If you see a 401 unauthorised error, please <a href="/.auth/login/aad">sign in again</a>.</p>
        </details>
      </form>
    </section>

    <!-- MIDDLE -->
    <section class="panel middle">
      <div class="row-between output-head">
        <h2 id="output-title">Conversation Guide</h2>
        <div class="row-between" style="gap:8px">
          <button id="toggle-bullets" class="btn inline" type="button" aria-pressed="false">Show bullet point
            script</button>
          <button id="popout" class="btn inline" type="button" title="Open script in a clean window">Pop-out</button>
          <div class="meta" id="output-meta" aria-live="polite" style="color:var(--text-2);font-size:.9rem"></div>
        </div>
      </div>

      <div id="output" class="output" tabindex="0" aria-label="Your winning hints and tips will appear here."></div>

      <div class="output-actions">
        <button id="copy-script" class="btn inline" type="button" disabled>Copy script</button>
        <button id="download-script" class="btn inline" type="button" disabled>Download script</button>

        <button id="toggle-highlighter" class="btn inline" type="button" aria-pressed="false">Highlighter</button>
        <button id="clear-highlights" class="btn inline" type="button">Clear highlights</button>
      </div>

      <div class="notes-card card" style="margin-top:var(--s-4)">
        <div class="row-between">
          <h3>Call notes</h3>
        </div>
        <textarea id="notes" rows="6"
          placeholder="Type your notes here. Click on any button to add to your notes. Use the look up to find information that may be missing. Your notes (only) are used to create the follow-up email."></textarea>
        <div class="row-between" style="gap:8px;margin-top:8px">
          <button id="save-notes" class="btn inline" type="button">Copy to clipboard</button>
          <button id="download-notes" class="btn inline" type="button">Download notes</button>
          <button id="make-followup" class="btn inline" type="button">Create follow-up email</button>
        </div>
        <p class="muted" style="margin-top:.5rem">Notes are downloaded to your device.</p>
      </div>


      <div class="change-log" style="margin-top:var(--s-4)">
        <h3>What changed</h3>
        <ul id="delta-log" class="delta" aria-live="polite"></ul>
      </div>
      <div class="activity" style="margin-top:var(--s-4)">
        <h3>Recent activity</h3>
        <ol id="activity-log" class="activity-log" aria-live="polite" style="margin:0;padding-left:1.25rem"></ol>
      </div>
    </section>

    <!-- Script Pop-out Modal -->
    <dialog id="script-modal" class="modal">
      <button id="close-modal" class="btn">Close ×</button>
      <div id="modal-script" class="output" style="min-height:auto"></div>
    </dialog>

    <!-- Follow-up Email Modal -->
    <dialog id="email-modal" class="modal">
      <div class="card" style="max-width:760px">
        <div class="row-between" style="align-items:center;gap:8px">
          <h3 style="margin:0">Follow-up email</h3>
          <button id="email-close" class="btn inline" type="button">Close ×</button>
        </div>
        <textarea id="email-text" rows="14" style="width:100%;margin-top:12px" aria-label="Follow-up email"></textarea>
        <div class="row-between" style="gap:8px;margin-top:12px">
          <button id="email-copy" class="btn inline" type="button">Copy to clipboard</button>
          <button id="email-download" class="btn inline" type="button">Download .txt</button>
        </div>
      </div>
    </dialog>

    <!-- Help Modal -->
    <dialog id="help-modal" class="modal">
      <div class="card" style="max-width:700px">
        <div class="row-between" style="align-items:center">
          <h3 style="margin:0">About this tool</h3>
          <button id="help-close" class="btn inline" type="button">Close ×</button>
        </div>
        <p>This Sales call scripting and emailing tool is designed to save you time. In just a minute, you can prepare a
          sharp, buyer-centred conversation guide for sales calls, and then turn your call notes into a concise
          follow-up
          email. Scripts and emails blend your inputs (prospect, product, USPs, context and desired next step) with our
          call-library templates and current buyer intelligence to produce high quality sales content fast.</p>

        <h3>How to use it</h3>
        <ol>
          <li><strong>Set the sales model:</strong> choose <em>Direct</em> or <em>Partner</em> at the top.</li>
          <li><strong>Complete Call details:</strong> your name/company and the prospect’s name, role and company.</li>
          <li><strong>Targeting:</strong> pick the <em>Product</em> and <em>Buyer behaviour</em>. The <em>Buyer
              needs</em> panel on the right updates to match.</li>
          <li><strong>Script preferences:</strong> choose tone and length. Add:
            <ul>
              <li><strong>Unique Selling Points</strong> – the core advantages you want emphasised.</li>
              <li><strong>Other points to cover</strong> – any extra themes or constraints.</li>
              <li><strong>Your desired next step</strong> – if you have a preferred CTA.</li>
            </ul>
          </li>
          <li><strong>Generate script:</strong> click <em>Go</em>. The <em>Conversation Guide</em> appears
            in the middle, with clear sections (Opening, Buyer Pain, Buyer Desire, Example, Objections, Next Step).</li>
          <li><strong>Use it:</strong> copy or download the script using the buttons under the guide. The tips card
            gives three quick coaching pointers.</li>
          <li><strong>During the call:</strong> type into <em>Call notes</em> (saved locally in your browser).</li>
          <li><strong>After the call:</strong> click <em>Create follow-up email</em> to generate a short, crisp email
            that stitches together your script and notes.</li>
        </ol>

        <h3>What the tool assures</h3>
        <ul>
          <li>These tools save you time and assure that every call you make is the best it could be.</li>
          <li>All scripts follow proven best practice sales methods focused on delivering value to the prospect in ways
            that build trust and lead to well qualified opportunities.</li>
          <li>You can choose from a professional, more corporate tone of language, or a warmer one if you prefer.</li>
          <li>Uses your Next step if provided. If not, it uses the follow up from the researched sales pitches that are
            centred on what prospects have said they would value.</li>
          <li>The scripts produced are an elegant blend of your requirements for the call and the researched sales
            pitches.</li>
        </ul>

        <h3>Where the insights come from</h3>
        <p>Buyer information and behaviours are refreshed monthly. The underlying sales pitches are researched every six
          months across technology buyers and indirect channel players. Together, this gives you a gold-standard view
          of current commercial status, pains, priorities, triggers, proof points, objections and CTAs for each buyer
          behaviour.</p>

        <h3>Tips for best results</h3>
        <ul>
          <li>Be specific in USPs (e.g., “Starlink for remote sites; pooled mobile data across teams”).</li>
          <li>Use <em>Other points</em> for constraints (timelines, budget signals, existing suppliers) to steer the
            tone.</li>
          <li>Always enter a practical <em>Next step</em> if you have one; it takes precedence.</li>
        </ul>

        <h3>Privacy & storage</h3>
        <ul>
          <li><em>Call notes</em> are stored locally in your browser only.</li>
          <li>The script is generated server-side; if you see a 401 error, sign in again via the Diagnostics link.</li>
        </ul>

        <h3>Troubleshooting</h3>
        <ul>
          <li>If a required field is missing, the status bar will say what to complete.</li>
          <li>If generation fails, open <em>Diagnostics</em> to view the error and try again.</li>
          <li>Product list empty? Check you’ve selected the correct sales model (Direct/Partner).</li>
        </ul>

        <h3>Feedback</h3>
        <p>We want these tools to be the best for you. If you have ideas for improvements or suggestions that would make
          this even more valuable to you, please contact us through our website.</p>
      </div>
    </dialog>

    <!-- RIGHT -->
    <section class="panel right" aria-labelledby="helpers-title">
      <div class="row-between output-head">
        <h2 id="helpers-title">More winning info</h2>

        <!-- Buyer needs -->
        <aside class="intel card">
          <div class="intel-head">
            <h2 id="intel-title">Buyer needs</h2>
            <button id="toggle-intel" class="btn small" type="button" aria-expanded="false" aria-controls="intel-body">
              Show
            </button>
          </div>

          <div id="intel-body" hidden>
            <div class="intel-grid">
              <section>
                <h3>1) Buyer Priorities</h3>
                <ul id="intel-priorities" class="intel-slot"></ul>
              </section>
              <section>
                <h3>2) Typical Pains</h3>
                <ul id="intel-pains" class="intel-slot"></ul>
              </section>
              <section>
                <h3>3) Triggers</h3>
                <ul id="intel-triggers" class="intel-slot"></ul>
              </section>
              <section>
                <h3>4) Value Proof</h3>
                <ul id="intel-proof" class="intel-slot"></ul>
              </section>
              <section>
                <h3>5) Objections</h3>
                <ul id="intel-objections" class="intel-slot"></ul>
              </section>
              <section>
                <h3>6) CTAs</h3>
                <ul id="intel-ctas" class="intel-slot"></ul>
              </section>
            </div>
          </div>
        </aside>

        <!-- Sales tips -->
        <aside class="intel card">
          <div class="intel-head">
            <h2 id="tips-title">Sales tips</h2>
            <button id="toggle-tips" class="btn small" type="button" aria-expanded="true" aria-controls="tips-body">
              Hide
            </button>
          </div>
          <div id="tips-body">
            <ul id="tips-list"></ul>
          </div>
        </aside>
      </div>
    </section>
    </section>
  </main>

  <template id="activity-item">
    <li>
      <span class="time"></span>
      <span class="pill product"></span>
      <span class="pill buyer"></span>
      <span class="pill length"></span>
    </li>
  </template>

  <!-- App logic -->
  <script type="module" src="/src/js/engagement/app.js"></script>
</body>

</html>
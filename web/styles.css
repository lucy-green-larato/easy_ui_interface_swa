/* === Inside Track Tools — UX polish v1.5 ================================ */
/* Brand-safe, responsive, accessible. 3-col layout with strong form UX.  */

/* === Global / Design Tokens ============================================ */
:root{
  /* Color (light) */
  --bg:#f6f7fb; --card-bg:#fff; --border:#e2e5ea;
  --text-1:#1d2129; --text-2:#4a5160;
  --accent:#72369d; --accent-pressed:#5f2d81;

  /* Status (ensure these exist) */
  --danger:#c43d4b;
  --ok:#1b8f5a;

  /* Stage & header */
  --stage-max:100vw;      /* full width */
  --header-h:64px;

  /* 3-col proportions */
  --left-min:480px; --middle-min:780px; --right-min:220px;

  /* Elevation / radii / rings */
  --radius:12px;
  --ring-shadow:0 0 0 2px rgba(114,54,157,.35);
  --ring-outline:3px solid rgba(114,54,157,.8);
  --shadow:0 1px 2px rgba(0,0,0,.06), 0 6px 24px rgba(0,0,0,.06);

  /* Fluid type scale */
  --fs-base:clamp(15px,0.28vw + 14px,18px);
  --fs-h1:clamp(22px,1.2vw + 18px,30px);
  --fs-h2:clamp(18px,0.9vw + 14px,22px);
  --fs-h3:clamp(16px,0.7vw + 12px,18px);

  /* Spacing */
  --s-1:4px; --s-2:8px; --s-3:12px; --s-4:16px; --s-5:24px; --s-6:32px;
  --gap:var(--s-6);

  /* Field control size */
  --fs-field:clamp(14px,0.26vw + 12px,16px);
  --field-h:42px;
}

*{box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  margin:0;
  font:var(--fs-base)/1.5 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans";
  background:var(--bg); color:var(--text-1);
  text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased;
}
h1,h2,h3{margin:0 0 var(--s-2); line-height:1.2; font-weight:600}
h1{font-size:var(--fs-h1)} h2{font-size:var(--fs-h2)} h3{font-size:var(--fs-h3)}

/* Focus ring for keyboard users */
:where(a,button,[role="button"],[tabindex]:not(input):not(select):not(textarea)):focus-visible{
  outline:var(--ring-outline); outline-offset:2px; border-radius:10px;
}

/* Scrollbars (WebKit) */
*::-webkit-scrollbar{width:10px;height:10px}
*::-webkit-scrollbar-thumb{background:#cfd5e0;border-radius:999px}
*::-webkit-scrollbar-thumb:hover{background:#b8c1d0}

/* === Header (sticky) ==================================================== */
.app-header{
  position:sticky; top:0; z-index:100;
  display:flex; align-items:center; justify-content:space-between; gap:.75rem;
  padding:12px 24px; background:var(--card-bg); border-bottom:1px solid var(--border);
  box-shadow:0 1px 2px rgba(16,24,40,.08),0 1px 1px rgba(16,24,40,.06);
  min-height:var(--header-h);
}

/* Left: logo & brand text */
.header-left{display:flex; align-items:center; gap:12px; min-width:0; flex:1 1 auto}
.logo{height:32px; width:auto; object-fit:contain; display:block}
.brand-text{display:flex; flex-direction:column; justify-content:center; min-width:0}
.app-title{white-space:nowrap; overflow:hidden; text-overflow:ellipsis; line-height:1.15}
.kicker{font-size:.9em; color:var(--text-2); margin-top:2px}

/* Right cluster */
.header-right{display:flex; align-items:center; gap:12px; flex-wrap:nowrap}
.header-right>*{flex-shrink:0}

/* Unified “chip” pattern — makes Sales model match other badges */
.badge,.model-note,.calltype-mini{
  --chip-h:34px;
  display:inline-flex; align-items:center; gap:.5rem;
  height:var(--chip-h); padding:0 12px; border-radius:999px;
  background:#eef0f4; border:1px solid var(--border);
  font-size:.92rem; line-height:1; white-space:nowrap;
}
.badge svg{width:16px;height:16px;stroke:currentColor;fill:none;stroke-width:2}
.badge.is-hidden{display:none}

/* Sales Model internals */
.calltype-mini .mini-label{font-weight:600}
.calltype-mini select{
  height:28px; padding:0 10px; line-height:28px;
  border-radius:8px; border:1px solid #cfd7eb; background:#fff;
}
.calltype-mini .remember{display:inline-flex; align-items:center; gap:6px; margin-left:4px}
.calltype-mini .remember input[type="checkbox"]{width:16px;height:16px;margin:0}

/* === Layout — 3-column grid ============================================ */
.stage{width:100%; max-width:var(--stage-max); margin-inline:auto}
.layout{
  display:grid; gap:var(--gap); padding:var(--gap); align-items:start; width:100%;
  grid-template-columns:
    minmax(0, 1.35fr)                      /* LEFT  */
    minmax(0, 2.65fr)                      /* MIDDLE*/
    minmax(var(--right-min), clamp(260px,14vw,300px)); /* RIGHT */
}

/* === Panels ============================================================= */
.panel{
  position:relative; background:var(--card-bg); border:1px solid var(--border);
  border-radius:var(--radius); padding:18px; box-shadow:var(--shadow); min-width:0;
}
.panel.left{grid-column:1}
.panel.middle{grid-column:2}
.panel.right{grid-column:3; max-width:300px}

/* Avoid nested double borders */
.panel .card{background:transparent; border:0; box-shadow:none; padding:0; margin:0}

/* === Left panel — step-by-step, easy to scan ============================ */
/* Its own scroll area on wide screens → clear “there’s more” affordance */
.panel.left{
  max-height:calc(100vh - var(--header-h) - var(--gap)*1.5);
  overflow:auto;
  background:
    linear-gradient(var(--card-bg),var(--card-bg)) padding-box,
    linear-gradient(to bottom, rgba(0,0,0,.08), rgba(0,0,0,0)) top/100% 12px no-repeat,
    linear-gradient(to top,   rgba(0,0,0,.08), rgba(0,0,0,0)) bottom/100% 12px no-repeat;
  background-attachment:local, scroll, scroll;
  counter-reset:section;
}

/* Section titles: numbered & sticky */
fieldset{border:0; margin:0; padding:0}
.card>legend,.card>h2{display:block; margin:0 0 var(--s-2); font-size:1.05rem; font-weight:700}
.panel.left .card>legend{
  position:sticky; top:0; z-index:1; padding:6px 0 8px;
  background:linear-gradient(var(--card-bg),var(--card-bg));
  border-bottom:1px solid var(--border);
}
.panel.left .card>legend::before{
  counter-increment:section; content: counter(section) ". ";
  color:var(--accent); font-weight:700; margin-right:2px;
}

/* Clear separation between sections */
.panel.left .card{padding-top:12px; margin-top:14px; border-top:1px dashed var(--border)}
.panel.left .card:first-of-type{margin-top:0; padding-top:0; border-top:0}

/* Form grid & fields */
.grid-2{display:grid; grid-template-columns:1fr 1fr; column-gap:16px; row-gap:8px}
.field{display:flex; flex-direction:column; gap:6px; margin-bottom:6px}
label{font-weight:600; font-size:.95rem}
.req{color:var(--danger)}
input,select,textarea{
  width:100%; min-height:var(--field-h);
  padding:9px 12px; border-radius:12px; border:1px solid #dee3ea; background:#fff;
  font:var(--fs-field)/1.45 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  letter-spacing:.005em; outline:none; transition:border-color .15s, box-shadow .15s;
}
textarea{min-height:100px; resize:vertical}
textarea::placeholder,input::placeholder{
  font:var(--fs-field)/1.45 ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
  letter-spacing:.005em; color:#6b7280;
}
select{-webkit-appearance:none; appearance:none; background-image:none}
input:focus,select:focus,textarea:focus{border-color:var(--accent); box-shadow:var(--ring-shadow)}
input.invalid,select.invalid,textarea.invalid{border-color:var(--danger)}
.help{margin:.35rem 0 0; color:var(--text-2); font-size:.85rem}
.error{min-height:1.1rem; color:var(--danger); font-size:.9rem; margin:.25rem 0 0}
.error-inline{color:var(--danger); font-size:.85rem; margin-left:.25rem}
input[disabled],select[disabled],textarea[disabled]{background:#f3f4f6; color:#6b7280; border-color:#e5e7eb; cursor:not-allowed}

/* Fieldset-specific tuning */
.card[aria-labelledby="legend-call-details"] .grid-2{row-gap:6px}
.card[aria-labelledby="legend-call-details"] .field{margin-bottom:4px; gap:4px}
.card[aria-labelledby="legend-preferences"] .grid-2{row-gap:12px}
.card[aria-labelledby="legend-preferences"] .field{margin-bottom:8px; gap:6px}

/* Buttons */
.actions{display:flex; gap:var(--s-3); align-items:center; margin-top:var(--s-3); flex-wrap:wrap}
.btn{
  display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:999px;
  border:1px solid #e5e8ee; background:#fff; cursor:pointer; font-weight:600
}
.btn.small{padding:6px 10px; font-size:.9rem}
.btn[disabled]{opacity:.55; cursor:not-allowed}
.btn.primary{background:var(--accent); color:#fff; border-color:transparent}
.btn.primary:hover{background:var(--accent-pressed)}
.btn:focus-visible{box-shadow:var(--ring-shadow); border-color:var(--accent)}
.spinner{width:16px; height:16px; border-radius:50%; border:2px solid rgba(255,255,255,.5); border-top-color:#fff; display:none}
.btn.primary.busy .spinner{display:inline-block; animation:spin .9s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.status{margin-top:var(--s-2); min-height:1.2rem; color:var(--text-2)}
.status[data-kind="error"]{color:var(--danger)}
.status[data-kind="ok"]{color:var(--ok)}

/* === Middle (Script) ==================================================== */
.panel.middle{display:grid; grid-template-columns:1fr; gap:var(--s-4)}
.output-card .output-head{display:flex; align-items:center; justify-content:space-between; gap:var(--s-2)}
.output-card .meta{color:var(--text-2); font-size:.9rem}
.output{
  white-space:pre-wrap; background:#fff; color:#1f2937; border:1px solid #e5e7eb;
  padding:14px; border-radius:12px; min-height:240px; outline:none; resize:vertical;
  font-variant-ligatures:contextual;
}
.panel.middle .output-card{position:sticky; top:calc(var(--header-h) + 12px); z-index:5}
.output-actions{display:flex; gap:8px; align-items:center; justify-content:flex-end; margin-top:8px}

/* Hide “Bullet point” and “Pop-out” actions (robust selectors) */
.output-head [data-action*="bullet" i],
.output-head [data-action*="pop" i],
.output-head [title*="bullet" i],
.output-head [title*="pop" i],
.output-head [aria-label*="bullet" i],
.output-head [aria-label*="pop" i],
.output-head button#bullet, .output-head .bullet,
.output-head #popout, .output-head .popout{
  display:none !important;
}

/* === Right (Buyer needs) =============================================== */
.intel .intel-head{
  display:flex; align-items:center; gap:var(--s-2);
  position:sticky; top:calc(var(--header-h) + 8px); background:var(--card-bg); z-index:4; padding-top:6px;
  border-bottom:1px solid var(--border); padding-bottom:6px;
}
/* Make the Hide button flush-right and chip-sized */
.intel .intel-head > :last-child{margin-left:auto}
.intel .intel-head :where(button, .btn){
  height:34px; padding:0 12px; border-radius:999px; border:1px solid var(--border);
  background:#eef0f4; font-size:.9rem; line-height:1; display:inline-flex; align-items:center;
}

.intel-grid{display:grid; grid-template-columns:1fr !important; gap:10px}
.intel-grid section{background:transparent; padding:0}
.intel-slot{
  background:transparent; padding:8px 0 0; color:var(--text-2);
  border-top:1px solid var(--border); border-radius:0;
}
/* First section also shows a divider */
.intel-grid section:first-child .intel-slot{border-top:1px solid var(--border)!important}

.intel-grid h3{font-size:.95rem; font-weight:600; margin:0 0 6px}
.intel-slot p{font-size:.92rem; line-height:1.35; margin:4px 0}
.intel-grid ul{list-style:none; padding-left:0; margin:6px 0 0; display:flex; flex-wrap:wrap; gap:6px}
.intel-grid li{display:inline-block; padding:4px 8px; border:1px solid var(--border); border-radius:8px; background:var(--card-bg); font-size:.85rem; color:var(--text-2)}
.intel-chip{display:inline-block; padding:4px 8px; border:1px solid var(--border); border-radius:8px; background:var(--card-bg); font-size:.85rem; color:var(--text-2); margin:0 6px 6px 0}

/* Tips card */
.tips-card h3{font-size:.95rem; font-weight:600; margin:0 0 6px}
.tips-card ul{margin:6px 0 0; padding-left:1.15rem}
.tips-card li{font-size:.92rem; line-height:1.35; margin:4px 0}

/* === Dark Mode ========================================================== */
@media (prefers-color-scheme: dark){
  :root{
    --bg:#0f1318; --card-bg:#141a1f; --border:#2a3342;
    --text-1:#e6eaf2; --text-2:#a9b2c3;
    --accent:#9b7abd; --accent-pressed:#8461a7;
    --shadow:0 1px 2px rgba(0,0,0,.25), 0 8px 30px rgba(0,0,0,.35);
    --danger:#e05b67; --ok:#29a06b;
  }
  .output{background:var(--card-bg); border-color:var(--border); color:var(--text-1)}
  input,select,textarea{background:#10151d; color:#e6eaf2; border-color:#2a3342}
  .intel-grid li,.intel-chip{background:#1d2532; color:var(--text-2); border-color:#2a3342}
  *::-webkit-scrollbar-thumb{background:#3a4559}
  *::-webkit-scrollbar-thumb:hover{background:#4b5870}
}

/* === Single-select caret ================================================ */
select:not([multiple]){
  -webkit-appearance:none; -moz-appearance:none; appearance:none;
  background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%236b7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'/></svg>");
  background-repeat:no-repeat; background-position:right 12px center; background-size:14px 14px;
  padding-right:36px;
}
@media (prefers-color-scheme: dark){
  select:not([multiple]){
    background-image:url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23a9b2c3' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><polyline points='6 9 12 15 18 9'/></svg>");
  }
}

/* === Ultra-wide tuning ================================================== */
@media (min-width:1800px){
  .layout{
    grid-template-columns:
      minmax(0,1.4fr)
      minmax(0,3fr)
      minmax(var(--right-min),300px);
  }
}

/* === Laptop: stack right rail under script ============================= */
@media (max-width:1200px){
  .layout{grid-template-columns:1fr 1fr}
  .panel.left{grid-column:1; max-height:none}  /* allow full page scroll */
  .panel.middle{grid-column:2}
  .panel.right{grid-column:1 / -1; max-width:none}
}

/* === Tablet / Phone ==================================================== */
@media (max-width:860px){
  .layout{grid-template-columns:1fr}
  .panel.left,.panel.middle,.panel.right{grid-column:1}
  .panel.middle{grid-template-columns:1fr}
  .grid-2{grid-template-columns:1fr}
}

/* === Accessibility: motion & contrast ================================= */
@media (prefers-reduced-motion: reduce){
  *{animation-duration:.001s !important; animation-iteration-count:1 !important; transition:none !important}
}
@media (prefers-contrast: more){
  :root{--border:#8a93a6}
  .btn,.calltype-mini,.model-note,.badge{border-width:2px}
  :where(a,button,[role="button"],[tabindex]:not(input):not(select):not(textarea)):focus-visible{outline-width:4px}
}

/* === Print: one-page script export ==================================== */
@media print{
  @page{margin:16mm}
  body{background:#fff; color:#000}
  .app-header, .panel.left, .panel.right, .actions, #diagnostics, .status{display:none !important}
  .layout{display:block; padding:0; max-width:none}
  .output-card, .output{box-shadow:none; border:0; padding:0}
  #output-title{margin:0 0 6mm; font-size:20pt}
  #output{font:12pt/1.4 "Segoe UI", Roboto, Arial, sans-serif; white-space:pre-wrap}
  .change-log,.activity{display:none}
}

/* === Utilities ========================================================= */
.sr-only{
  position:absolute !important; width:1px !important; height:1px !important;
  padding:0 !important; margin:-1px !important; overflow:hidden !important;
  clip:rect(0,0,0,0) !important; white-space:nowrap !important; border:0 !important;
}
.row-between{display:flex; align-items:center; justify-content:space-between; gap:8px}

/* === Modal (kept for future, triggers hidden above) ==================== */
.modal{
  width:80%; height:80%; max-width:900px; border:none; padding:1rem;
  background:#fff; border-radius:1rem; box-shadow:0 0 20px rgba(0,0,0,0.3);
}
.modal pre{white-space:pre-wrap; font-size:.95rem; line-height:1.4; overflow-y:auto; max-height:calc(100% - 3rem)}
.modal::backdrop{background:rgba(0,0,0,0.6)}
#close-modal{float:right; margin-bottom:.5rem}

/* === Script output formatting ========================================= */
.script-body h3{margin-top:1.2em; margin-bottom:.5em; font-size:1.1rem; color:#111827}
.script-body p{margin:.6em 0; line-height:1.6}
.script-body ul{margin:.5em 0 .75em 1.25rem}
.script-body li{margin:.25em 0}
.script-body strong{font-weight:550}
.script-body{font-size:1rem; color:#111827}

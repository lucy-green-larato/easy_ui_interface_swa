/* === Global / Design Tokens ======================================= */
:root{
  /* Color tokens (light) */
  --bg:#f6f7fb;
  --card-bg:#ffffff;
  --border:#e2e5ea;
  --text-1:#1d2129;
  --text-2:#4a5160;
  --accent:#2458e6;
  --accent-pressed:#1f49be;
  --danger:#b00020;
  --ok:#0a7f2e;

  /* Stage & header */
  --stage-max: 1350px;            /* slightly wider to fit 4/6/2 layout */
  --header-h: 64px;

  /* 3-col proportions */
  --left-min: 480px;
  --middle-min: 780px;
  --right-min: 260px;             /* slimmer right rail */

  /* Elevation / radii / rings */
  --radius:12px;
  --ring-shadow: 0 0 0 2px rgba(36,88,230,.35);
  --ring-outline: 3px solid rgba(36,88,230,.8);
  --shadow:0 1px 2px rgba(0,0,0,.06), 0 6px 24px rgba(0,0,0,.06);

  /* Fluid type scale */
  --fs-base: clamp(15px, 0.28vw + 14px, 18px);
  --fs-h1:   clamp(22px, 1.2vw + 18px, 30px);
  --fs-h2:   clamp(18px, 0.9vw + 14px, 22px);
  --fs-h3:   clamp(16px, 0.7vw + 12px, 18px);

  /* Spacing scale */
  --s-1:4px; --s-2:8px; --s-3:12px; --s-4:16px; --s-5:24px; --s-6:32px;
  --gap:var(--s-6);
}

*{box-sizing:border-box}
html{scroll-behavior:smooth}
body{
  margin:0;
  font: var(--fs-base)/1.5 ui-sans-serif, system-ui, -apple-system, "Segoe UI",
        Roboto, "Helvetica Neue", Arial, "Noto Sans";
  background:var(--bg);
  color:var(--text-1);
  text-rendering:optimizeLegibility;
  -webkit-font-smoothing:antialiased;
}
h1,h2,h3{margin:0 0 var(--s-2); line-height:1.2; font-weight:600}
h1{font-size:var(--fs-h1)} h2{font-size:var(--fs-h2)} h3{font-size:var(--fs-h3)}

/* Focus visibility: outline for non-form controls, shadow for form fields */
:where(a,button,[role="button"],[tabindex]:not(input):not(select):not(textarea)):focus-visible{
  outline:var(--ring-outline);
  outline-offset:2px;
  border-radius:10px;
}

/* Subtle scrollbars (WebKit) */
*::-webkit-scrollbar{width:10px;height:10px}
*::-webkit-scrollbar-thumb{background:#cfd5e0;border-radius:999px}
*::-webkit-scrollbar-thumb:hover{background:#b8c1d0}

/* === Header (sticky with light elevation) ========================= */
.app-header{
  position: sticky; top: 0; z-index: 100;
  display:flex; align-items:center; justify-content:space-between;
  gap:.75rem; padding:12px 24px; background:var(--card-bg);
  border-bottom:1px solid var(--border);
  box-shadow: 0 1px 2px rgba(16,24,40,.08), 0 1px 1px rgba(16,24,40,.06);
  min-height: var(--header-h);
}
.header-left{display:flex; align-items:center; gap:.75rem; min-width:0; flex:1 1 auto}
.logo{max-width:56px; max-height:56px; height:auto; width:auto; object-fit:contain}
.brand-text{display:flex; flex-direction:column; min-width:0}
.app-title{white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
.kicker{font-size:.9em; color:var(--text-2); margin-top:.125rem}
.header-right{display:flex; align-items:center; gap:.5rem}

/* Pills / sales model */
.calltype-mini{display:inline-flex; align-items:center; gap:.6rem; padding:8px 12px; border-radius:999px; background:#eef0f4; border:1px solid var(--border); font-size:.95rem}
.calltype-mini .mini-label{font-weight:600}
.calltype-mini select{padding:6px 10px; border-radius:8px; border:1px solid #cfd7eb; background:#fff}
.model-note,.badge{display:inline-flex; align-items:center; gap:.35rem; padding:6px 10px; border-radius:999px; background:#eef0f4; border:1px solid var(--border); font-size:.9rem}
.badge svg{width:16px; height:16px; stroke:currentColor; fill:none; stroke-width:2}
.badge.is-hidden{display:none}

/* === Layout — centered 3-column grid =============================== */
.stage{max-width: var(--stage-max); margin-inline:auto}
.layout{
  display:grid; gap:var(--gap); padding:var(--gap); align-items:start; width:100%;
  max-width: var(--stage-max);
  margin-inline: auto;
  grid-template-columns:
    minmax(var(--left-min), 1.1fr)
    minmax(var(--middle-min), 2.2fr)
    clamp(var(--right-min), 22vw, 340px);
}

/* === Three white “windows” ======================================== */
.panel{
  position: relative;
  background:var(--card-bg);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:18px;
  box-shadow:var(--shadow);
  min-width:0;
}
.panel.left{grid-column:1}
.panel.middle{grid-column:2}
.panel.right{grid-column:3; max-width:340px} /* keep the rail slim */

/* Kill nested “double boxes” */
.panel .card{background:transparent; border:0; box-shadow:none; padding:0; margin:0}

/* Section titles within panels */
fieldset{border:0; margin:0; padding:0}
.card>legend,.card>h2{display:block; margin:0 0 var(--s-2); font-size:1.05rem; font-weight:700}
.card>.kicker{ margin:-2px 0 10px; color:var(--text-2); font-size:.9rem; }

/* === Form ========================================================= */
.grid-2{display:grid; grid-template-columns:1fr 1fr; gap:14px 16px}
.field{margin:0}
label{display:block; margin:2px 0 6px; font-weight:600; font-size:.95rem}
.req{color:var(--danger)}
input,select,textarea{
  width:100%; padding:10px 12px; border-radius:12px; border:1px solid #dee3ea; background:#fff;
  font:inherit; line-height:1.4; outline:none; transition: box-shadow .15s ease, border-color .15s ease;
}
select{ -webkit-appearance:none; appearance:none; background-image:none; }
input:focus,select:focus,textarea:focus{ border-color: var(--accent); box-shadow: var(--ring-shadow); }
input.invalid,select.invalid,textarea.invalid{ border-color: var(--danger); }
.help{ margin:.35rem 0 0; color:var(--text-2); font-size:.85rem; }
.error{ min-height:1.1rem; color: var(--danger); font-size:.9rem; margin:.25rem 0 0; }
.error-inline{ color: var(--danger); font-size:.85rem; margin-left:.25rem; }
input[disabled],select[disabled],textarea[disabled]{ background:#f3f4f6; color:#6b7280; border-color:#e5e7eb; cursor:not-allowed; }

/* Buttons / actions */
.actions{ display:flex; gap: var(--s-3); align-items:center; margin-top: var(--s-3); flex-wrap:wrap; }
.btn{
  display:inline-flex; align-items:center; gap:8px; padding:10px 14px; border-radius:999px;
  border:1px solid #e5e8ee; background:#fff; cursor:pointer; font-weight:600
}
.btn.small{ padding:6px 10px; font-size:.9rem }
.btn[disabled]{ opacity:.55; cursor:not-allowed }
.btn.primary{ background: var(--accent); color:#fff; border-color: transparent }
.btn.primary:hover{ background: var(--accent-pressed) }
.btn:focus-visible{ box-shadow: var(--ring-shadow); border-color: var(--accent); }
.spinner{ width:16px; height:16px; border-radius:50%; border:2px solid rgba(255,255,255,.5); border-top-color:#fff; display:none }
.btn.primary.busy .spinner{ display:inline-block; animation:spin .9s linear infinite }
@keyframes spin{ to{ transform: rotate(360deg) } }
.status{ margin-top:var(--s-2); min-height:1.2rem; color:var(--text-2) }
.status[data-kind="error"]{ color: var(--danger) }
.status[data-kind="ok"]{ color: var(--ok) }

/* === Middle (Script) ============================================== */
.panel.middle{ display:grid; grid-template-columns:1fr; gap:var(--s-4) }
.output-card .output-head{ display:flex; align-items:baseline; justify-content:space-between; gap:var(--s-2) }
.output-card .meta{ color: var(--text-2); font-size:.9rem }
.output{
  white-space:pre-wrap; background:#fff; color:#1f2937; border:1px solid #e5e7eb;
  padding:14px; border-radius:12px; min-height:240px; outline:none; resize:vertical;
  font-variant-ligatures: contextual;
}
/* Keep the script visible under the sticky header */
.panel.middle .output-card{ position: sticky; top: calc(var(--header-h) + 12px); z-index: 5; }

/* === Right (Buyer needs) — single slim column ===================== */
.intel .intel-head{
  display:flex; align-items:center; justify-content:space-between; gap:var(--s-2);
  position:sticky; top: calc(var(--header-h) + 8px); background:var(--card-bg); z-index:4; padding-top:6px;
}
/* FORCE one column everywhere */
.intel-grid{ display:grid; grid-template-columns:1fr !important; gap:10px }
.intel-grid section{ background:transparent; padding:0 }
.intel-slot{
  background:transparent; padding:8px 0 0; color:var(--text-2);
  border-top:1px solid var(--border); border-radius:0;
}
.intel-grid section:first-child .intel-slot{ border-top:0 }

/* If your Buyer needs lists are UL/LI, render as compact chips */
.intel-grid ul{ list-style:none; padding-left:0; margin:6px 0 0; display:flex; flex-wrap:wrap; gap:6px }
.intel-grid li{ display:inline-block; padding:4px 8px; border:1px solid var(--border); border-radius:8px; background:var(--card-bg); font-size:.85rem; color:var(--text-2) }
/* If you output plain spans, give them the same chip look */
.intel-chip{ display:inline-block; padding:4px 8px; border:1px solid var(--border); border-radius:8px; background:var(--card-bg); font-size:.85rem; color:var(--text-2); margin:0 6px 6px 0 }

/* === Ultra-wide tuning ============================================ */
@media (min-width: 1600px){
  .layout{
    grid-template-columns:
      minmax(520px, 1.1fr)
      minmax(900px, 2.4fr)
      clamp(240px, 18vw, 340px);
  }
}

/* === Laptop: stack Buyer needs under Script ======================== */
@media (max-width: 1200px){
  .layout{ grid-template-columns:1fr 1fr }
  .panel.left{ grid-column:1 }
  .panel.middle{ grid-column:2 }
  .panel.right{ grid-column:1 / -1; max-width:none }
}

/* === Tablet / Phone =============================================== */
@media (max-width: 860px){
  .layout{ grid-template-columns:1fr }
  .panel.left,.panel.middle,.panel.right{ grid-column:1 }
  .panel.middle{ grid-template-columns:1fr }
  .grid-2{ grid-template-columns:1fr; }
}

/* === Accessibility: motion & contrast ============================= */
@media (prefers-reduced-motion: reduce){
  *{ animation-duration:.001s !important; animation-iteration-count:1 !important; transition:none !important }
}
@media (prefers-contrast: more){
  :root{ --border:#8a93a6; }
  .btn,.calltype-mini,.model-note,.badge{ border-width:2px }
  :where(a,button,[role="button"],[tabindex]:not(input):not(select):not(textarea)):focus-visible{ outline-width:4px }
}

/* === Dark Mode (auto) ============================================= */
@media (prefers-color-scheme: dark){
  :root{
    --bg:#0f1318; --card-bg:#141a1f; --border:#2a3342;
    --text-1:#e6eaf2; --text-2:#a9b2c3;
    --accent:#6da7ff; --accent-pressed:#5a8ee0;
    --shadow: 0 1px 2px rgba(0,0,0,.25), 0 8px 30px rgba(0,0,0,.35);
  }
  .output{ background:var(--card-bg); border-color:var(--border); color:var(--text-1) }
  input,select,textarea{ background:#10151d; color:var(--text-1); border-color:var(--border) }
  .intel-grid li,.intel-chip{ background:#1d2532; color:var(--text-2); border-color:#2a3342 }
  *::-webkit-scrollbar-thumb{ background:#3a4559 }
  *::-webkit-scrollbar-thumb:hover{ background:#4b5870 }
}

/* === Print: one-page script export ================================ */
@media print{
  @page{ margin:16mm }
  body{ background:#fff; color:#000 }
  .app-header, .panel.left, .panel.right, .actions, #diagnostics, .status{ display:none !important }
  .layout{ display:block; padding:0; max-width:none; }
  .output-card, .output{ box-shadow:none; border:0; padding:0; }
  #output-title{ margin:0 0 6mm; font-size:20pt }
  #output{
    font: 12pt/1.4 "Segoe UI", Roboto, Arial, sans-serif;
    white-space:pre-wrap;
  }
  .change-log,.activity{ display:none }
}

/* === Utilities ===================================================== */
.sr-only{
  position:absolute !important; width:1px !important; height:1px !important;
  padding:0 !important; margin:-1px !important; overflow:hidden !important;
  clip:rect(0,0,0,0) !important; white-space:nowrap !important; border:0 !important;
}
/* === Full-width 3-column layout (remove right-side empty space) === */

/* 1) Remove the stage/container cap */
:root { --stage-max: 100vw; }          /* no more 1350px cap */
.stage, .layout { max-width: none; }   /* allow full-bleed width */

/* 2) Make the grid actively use the whole width */
.layout{
  grid-template-columns:
    minmax(420px, 1.1fr)               /* LEFT  (Form)    */
    minmax(640px, 2.2fr)               /* MIDDLE (Script) */
    clamp(260px, 22vw, 420px);         /* RIGHT  (Buyer)  */
}

/* Keep the right rail narrow but not hard-capped */
.panel.right{ max-width: none; }

/* 3) Ultra-wide screens: scale a touch more while keeping the rail slim */
@media (min-width: 1800px){
  .layout{
    grid-template-columns:
      minmax(520px, 1.2fr)
      minmax(860px, 2.4fr)
      clamp(300px, 20vw, 520px);
  }
}


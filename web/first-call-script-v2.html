<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>First Call Script · Inside Track Tools</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-store" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; }
    header { padding: 16px; border-bottom: 1px solid #eee; display:flex; align-items:center; gap:12px; }
    header a { text-decoration: none; }
    main { max-width: 960px; margin: 0 auto; padding: 16px; }
    form { display: grid; gap: 12px; }
    label { font-weight: 600; }
    input, textarea, select { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 6px; font-size: 14px; }
    textarea { min-height: 100px; }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .actions { display: flex; gap: 12px; align-items: center; }
    button { padding: 10px 14px; border-radius: 6px; border: 1px solid #ccc; background: #fff; cursor: pointer; }
    button.primary { background: #111; color: #fff; border-color: #111; }
    .meta { color: #666; font-size: 13px; }
    pre { background: #f7f7f7; padding: 12px; border-radius: 6px; overflow: auto; }
    details { border: 1px solid #eee; border-radius: 6px; padding: 8px 12px; }
    .ok { color: #0a7f2e; }
    .err { color: #b00020; }
    .panel { border: 1px solid #eee; border-radius: 8px; padding: 12px; background: #fafafa; }
    .panel h3 { margin: 0 0 8px; font-size: 15px; }
    .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  </style>
</head>
<body>
  <header>
    <a href="/" aria-label="Home">⬅︎ Home</a>
    <h1 style="margin:0; font-size:18px;">First Call Script</h1>
    <span id="userBadge" class="meta" style="margin-left:auto;"></span>
  </header>

  <main>
    <p class="meta">Generate a concise, UK-style first call script for B2B technology outreach using the Larato 6-step structure.</p>

    <form id="tool-form" data-testid="first-call-form" autocomplete="off">
      <div class="row">
        <div>
          <label for="seller_name">Your name</label>
          <input id="seller_name" name="seller_name" required placeholder="e.g., Lucy Green" />
        </div>
        <div>
          <label for="seller_company">Your company</label>
          <input id="seller_company" name="seller_company" required placeholder="e.g., Larato" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="prospect_name">Prospect name</label>
          <input id="prospect_name" name="prospect_name" required placeholder="e.g., Alex Carter" />
        </div>
        <div>
          <label for="prospect_role">Prospect role</label>
          <input id="prospect_role" name="prospect_role" required placeholder="e.g., IT Director" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="prospect_company">Prospect company</label>
          <input id="prospect_company" name="prospect_company" required placeholder="e.g., Acme PLC" />
        </div>
        <div>
          <label for="tone">Tone</label>
          <select id="tone" name="tone">
            <option value="Professional">Professional</option>
            <option value="Warm">Warm</option>
            <option value="Challenger">Challenger</option>
            <option value="Friendly">Friendly</option>
            <option value="Technical">Technical</option>
            <option value="Consultative">Consultative</option>
          </select>
        </div>
      </div>

      <!-- Call type + Product/Service -->
      <div class="row">
        <div>
          <label for="call_type">Call type</label>
          <select id="call_type" name="call_type">
            <option value="Direct">Direct</option>
            <option value="Partner">Partner</option>
          </select>
        </div>
        <div>
          <label for="product">Product / service</label>
          <select id="product" name="product">
            <option>Mobile and fixed connectivity</option>
            <option>Cybersecurity</option>
            <option>Artificial Intelligence</option>
            <option>Hardware and software</option>
            <option>IT Solutions</option>
            <option>Microsoft solutions</option>
            <option>Telecommunications solutions</option>
          </select>
        </div>
      </div>

      <!-- Buyer type + Length -->
      <div class="row">
        <div>
          <label for="buyer_type">Buyer type (paste exact label from Inside Track)</label>
          <select id="buyer_type" name="buyer_type">
            <option>Innovator</option>
            <option>Early Adopter</option>
            <option>Early Majority</option>
            <option selected>Late Majority</option>
            <option>Sceptic</option>
          </select>
        </div>
        <div>
          <label for="length">Approx length</label>
          <select id="length" name="length">
            <option value="~100 words">~100 words</option>
            <option value="~150 words" selected>~150 words</option>
            <option value="~200 words">~200 words</option>
            <option value="~250 words">~250 words</option>
          </select>
        </div>
      </div>

      <!-- Market Intelligence Panel (appears here, under the row in the screenshot) -->
      <div id="playbookPanel" class="panel">
        <h3>Market Intelligence · Baseline Script</h3>
        <p class="meta" id="playbookMeta"></p>
        <textarea id="playbookOutput" readonly placeholder="Select a Product / service and Buyer type to view the baseline script…"></textarea>
      </div>

      <div class="row">
        <div>
          <label for="call_to_action">Call to action</label>
          <input id="call_to_action" name="call_to_action" placeholder="e.g., 45-minute Connectivity Audit next week?" />
        </div>
        <div><!-- spacer --></div>
      </div>

      <div>
        <label for="context">Context (why you, why now)</label>
        <textarea id="context" name="context" placeholder="e.g., Observed cloud costs rising while ticket resolution times increasing; recent merger adds complexity."></textarea>
      </div>

      <div>
        <label for="value_proposition">Value proposition</label>
        <textarea id="value_proposition" name="value_proposition" placeholder="e.g., We help UK MSPs cut CX costs 20–30% while lifting NPS via AI-assisted triage and knowledge surfacing."></textarea>
      </div>

      <details>
        <summary>Preview request payload</summary>
        <pre id="payloadPreview" data-testid="payload-preview"></pre>
      </details>

      <div class="actions">
        <button type="submit" class="primary" id="submitBtn" data-testid="submit-btn">Generate</button>
        <button type="button" id="resetBtn">Reset</button>
        <span id="status" class="meta" aria-live="polite"></span>
      </div>
    </form>

    <h2 style="margin-top:24px; font-size:16px;">Generated script</h2>
    <div class="actions" style="margin-bottom:8px;">
      <button type="button" id="copyBtn" aria-label="Copy script" disabled>Copy</button>
      <button type="button" id="downloadBtn" aria-label="Download script" disabled>Download .txt</button>
      <span id="copyStatus" class="meta" aria-live="polite"></span>
    </div>

    <!-- Two-column: Baseline vs Generated (optional). Keep just Generated if preferred. -->
    <div class="grid-2">
      <div>
        <p class="meta">Baseline (above) is static reference content from Inside Track research.</p>
      </div>
      <div>
        <textarea id="scriptOutput" readonly placeholder="Your generated script will appear here after Generate…"></textarea>
        <p id="scriptHelp" class="meta"></p>
      </div>
    </div>

    <h2 style="margin-top:24px; font-size:16px;">API response</h2>
    <pre id="result" data-testid="api-result" aria-live="polite"></pre>
  </main>

  <script>
    // ======== CONFIG ========
    const PACK = "uk_b2b_sales_core";
    const TEMPLATE = "first_call_script_v2";

    // Your market-intelligence library.
    // Add all product × buyer-type combinations here.
    // Keys must match the select option text for product and buyer_type.
    const PLAYBOOK = {
      "Mobile and fixed connectivity": {
        "Late Majority": `1 | Your buyer’s business need
Your business depends on reliable, cost-effective connectivity. But managing mobile and fixed services across multiple sites and teams is becoming more complex. You need a setup that just works, without requiring constant admin or firefighting. The goal is not transformation for its own sake — it’s smoother operations, clearer visibility and fewer headaches.

2 | Your buyer’s pain – Cost and Productivity Concerns
Most businesses reach a point where their existing telecoms setup starts to bite:
• Mobile usage is unpredictable and hard to forecast
• Fixed-line services are stuck in long contracts that no longer fit
• SLAs are missed and support is reactive
• No one has a full picture of what’s used, needed or wasted
Forty-three per cent of UK buyers say rising costs are already impacting plans. Thirty-two per cent say poor infrastructure is slowing them down. Even when things work on paper, the day-to-day effort to manage suppliers, changes and faults takes its toll.

3 | Aligning with your buyer’s business goals
You want infrastructure that supports growth without creating extra overhead. That usually includes:
• A single view of your mobile and fixed estate across all locations
• Alerts and usage controls to prevent overages before they happen
• A support model that prioritises response, not red tape
• Flexibility to scale bandwidth or shift SIMs without chasing paperwork
It’s not about the latest tech. It’s about having confidence in the basics, knowing the right service is in place and working when needed.

4 | An Example Illustration – From Problem to Solution (replace with your own if you prefer)
One national retailer was managing fixed and mobile services across 70 sites. Each site had negotiated its own contracts, and mobile usage was being expensed rather than tracked centrally. When a POS upgrade required connectivity changes, the IT team had no clear view of what was installed where.
Introducing a centralised estate view with pooled mobile data, flexible broadband provisioning and a support team who managed moves, adds and changes as a service delivered the following value.
In the first six months:
• Connectivity incidents dropped by 52 per cent
• Mobile overspend was cut by 34 per cent
• New store setup time dropped from 21 days to under 8
• Finance could reconcile costs against usage for the first time
The IT manager described it as “getting the lights turned back on”.

5 | Suggestions for Handling Objections whilst on a call
“We’ve got contracts we can’t get out of.”
We work with what’s in place and apply governance over the top. When renewals roll around, you’ll already have a better model to move toward.
“We don’t have time for a big project.”
That’s fine. We start small — usually with two to five sites — and get results within a single billing cycle. It’s low risk, high impact.
“This won’t fit our setup.”
We customise everything around your business. Whether you have legacy tech or regional variations, we build a model that flexes with you.

6 | Call to Action – Next Steps
Let’s schedule a 45-minute Connectivity Audit. You’ll get:
• A current-state map of your mobile and fixed services
• A savings and simplification plan tailored to your operational structure
• A pilot design that shows value within one quarter
I’ll also include our “Retail Connectivity Toolkit”, with benchmarking data, supplier scorecards and a governance checklist. Would Monday or Thursday next week suit your team?`
      }

      // Example placeholders for where to add the rest:
      // ,"Cybersecurity": { "Early Majority": "…", "Late Majority": "…", "Sceptic": "…" }
      // ,"Artificial Intelligence": { "Innovator": "…", "Early Adopter": "…" }
    };

    // ======== AUTH ========
    async function requireAuth() {
      try {
        const res = await fetch("/.auth/me", { credentials: "include", cache: "no-store" });
        const data = await res.json().catch(() => ({}));
        const user = data && data.clientPrincipal ? data.clientPrincipal : null;
        if (!user) {
          const redirect = "/.auth/login/aad?post_login_redirect_uri=" + encodeURIComponent(window.location.href);
          window.location.replace(redirect);
          throw new Error("Redirecting to login");
        }
        return user;
      } catch (e) {
        const redirect = "/.auth/login/aad?post_login_redirect_uri=" + encodeURIComponent(window.location.href);
        window.location.replace(redirect);
        throw e;
      }
    }

    // ======== FORM HELPERS ========
    function collectVariables(form) {
      const fd = new FormData(form);
      const vars = {};
      for (const [k, v] of fd.entries()) vars[k] = v;
      return vars;
    }

    function renderPayloadPreview(vars) {
      const preview = { pack: PACK, template: TEMPLATE, variables: vars };
      document.getElementById("payloadPreview").textContent = JSON.stringify(preview, null, 2);
    }

    function setUserBadge(user) {
      const el = document.getElementById("userBadge");
      if (!user) return;
      const name = user.userDetails || user.userId || "signed in";
      el.textContent = `Signed in as ${name}`;
      el.classList.add("ok");
    }

    function updateDownloadState(enabled) {
      document.getElementById("copyBtn").disabled = !enabled;
      document.getElementById("downloadBtn").disabled = !enabled;
    }

    // ======== PLAYBOOK UI ========
    function updatePlaybook(product, buyerType) {
      const out = document.getElementById("playbookOutput");
      const meta = document.getElementById("playbookMeta");
      const p = PLAYBOOK[product] || {};
      const text = p[buyerType] || "";

      meta.textContent = (product && buyerType)
        ? `Product: ${product} · Buyer type: ${buyerType}`
        : "";

      if (text) {
        out.value = text;
      } else {
        out.value = "No baseline script stored for this Product / Buyer type yet. Add it to PLAYBOOK in the page script.";
      }
    }

    // ======== BOOTSTRAP ========
    document.addEventListener("DOMContentLoaded", async () => {
      const user = await requireAuth();
      setUserBadge(user);

      const form = document.getElementById("tool-form");
      const statusEl = document.getElementById("status");
      const resultEl = document.getElementById("result");
      const submitBtn = document.getElementById("submitBtn");
      const copyBtn = document.getElementById("copyBtn");
      const downloadBtn = document.getElementById("downloadBtn");
      const copyStatus = document.getElementById("copyStatus");
      const resetBtn = document.getElementById("resetBtn");
      const scriptOutput = document.getElementById("scriptOutput");
      const scriptHelp = document.getElementById("scriptHelp");
      const productEl = document.getElementById("product");
      const buyerTypeEl = document.getElementById("buyer_type");

      // live preview + playbook refresh
      form.addEventListener("input", () => {
        const vars = collectVariables(form);
        renderPayloadPreview(vars);
        updatePlaybook(vars.product, vars.buyer_type);
      });
      renderPayloadPreview(collectVariables(form));
      updatePlaybook(productEl.value, buyerTypeEl.value);

      // reset clears everything
      resetBtn.addEventListener("click", () => {
        form.reset();
        resultEl.textContent = "";
        statusEl.textContent = "";
        scriptOutput.value = "";
        scriptHelp.textContent = "";
        copyStatus.textContent = "";
        updateDownloadState(false);
        renderPayloadPreview(collectVariables(form));
        updatePlaybook(productEl.value, buyerTypeEl.value);
      });

      // Copy button — attach once
      copyBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(scriptOutput.value || "");
        } catch {}
        copyStatus.textContent = "Copied";
        setTimeout(() => (copyStatus.textContent = ""), 1500);
      });

      // Download button
      downloadBtn.addEventListener("click", () => {
        const blob = new Blob([scriptOutput.value || ""], { type: "text/plain;charset=utf-8" });
        const url = URL.createObjectURL(blob);
        const a = Object.assign(document.createElement("a"), { href: url, download: "first-call-script.txt" });
        a.click();
        URL.revokeObjectURL(url);
      });

      // Submit handler
      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        resultEl.textContent = "";
        scriptOutput.value = "";
        scriptHelp.textContent = "";
        statusEl.textContent = "Submitting…";
        submitBtn.disabled = true;
        updateDownloadState(false);

        const variables = collectVariables(form);
        renderPayloadPreview(variables);

        try {
          const res = await fetch("/api/generate", {
            method: "POST",
            credentials: "include",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ pack: PACK, template: TEMPLATE, variables })
          });

          const text = await res.text();
          let json;
          try { json = JSON.parse(text); } catch { json = { raw: text }; }

          if (!res.ok) {
            statusEl.textContent = "Error";
            statusEl.classList.add("err");
          } else {
            statusEl.textContent = "OK";
            statusEl.classList.remove("err");
            statusEl.classList.add("ok");
          }

          resultEl.textContent = JSON.stringify(json, null, 2);

          // Display only model output (server returns output; preview is debug only)
          const generated = (json && typeof json.output === "string" && json.output.trim()) ? json.output.trim() : "";
          if (generated) {
            scriptOutput.value = generated;
            updateDownloadState(true);
          } else {
            scriptOutput.value = "";
            scriptHelp.textContent = "No generated text yet — API returned no model output.";
            updateDownloadState(false);
          }
        } catch (err) {
          statusEl.textContent = "Request failed";
          statusEl.classList.add("err");
          resultEl.textContent = String(err);
          updateDownloadState(false);
        } finally {
          submitBtn.disabled = false;
        }
      });
    });
  </script>
</body>
</html>
